<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/ingreso/signup.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro - TP Descuentos</title>
</head>
<body>
  <form class="form" id="registerForm">
    <p class="title">Registrarse</p>
    <p class="message">Una app para manejar tus billeteras virtuales</p>
    
    <div class="flex">
        <label>
            <input class="input" type="text" id="nombre" placeholder="" required>
            <span>Nombre</span>
        </label>

        <label>
            <input class="input" type="text" id="apellido" placeholder="" required>
            <span>Apellido</span>
        </label>
    </div>  

    <label>
        <input class="input" type="email" id="email" placeholder="" required>
        <span>Email</span>
    </label> 

    <label>
        <input class="input" type="password" id="password" placeholder="" required>
        <span>Contraseña</span>
    </label>

    <label>
        <input class="input" type="password" id="confirmPassword" placeholder="" required>
        <span>Confirmar Contraseña</span>
    </label>

    <!-- Mensaje de error/éxito -->
    <div id="message" class="message" style="display: none;"></div>

    <button type="submit" class="submit" id="registerBtn">Registrarse</button>
    <p class="signin">
        <a href="login.html">¿Ya tienes una cuenta? Inicia sesión</a>
        <br>
        <a href="/" style="margin-top: 10px; display: inline-block;">Volver al inicio</a>
    </p>
  </form>

<!-- Scripts -->
<script src="/front/services/auth.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const registerForm = document.getElementById('registerForm');
    const messageDiv = document.getElementById('message');
    const registerBtn = document.getElementById('registerBtn');

    // Verificar si ya está autenticado
    if (authService.isAuthenticated()) {
        showMessage('Ya tienes una sesión activa. Redirigiendo...', 'success');
        setTimeout(() => {
            window.location.href = '/';
        }, 2000);
        return;
    }

    registerForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const nombre = document.getElementById('nombre').value.trim();
        const apellido = document.getElementById('apellido').value.trim();
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirmPassword').value;

        // Validaciones
        if (!nombre || !apellido || !email || !password || !confirmPassword) {
            showMessage('Por favor, completa todos los campos', 'error');
            return;
        }

        if (password !== confirmPassword) {
            showMessage('Las contraseñas no coinciden', 'error');
            return;
        }

        if (password.length < 6) {
            showMessage('La contraseña debe tener al menos 6 caracteres', 'error');
            return;
        }

        if (!isValidEmail(email)) {
            showMessage('Por favor, ingresa un email válido', 'error');
            return;
        }

        try {
            // Deshabilitar botón durante el proceso
            registerBtn.disabled = true;
            registerBtn.textContent = 'Registrando...';

            const userData = {
                nombre,
                apellido,
                email,
                password
            };

            const result = await authService.register(userData);
            
            showMessage(result.message || 'Registro exitoso', 'success');
            
            // Redirigir después de un breve delay
            setTimeout(() => {
                window.location.href = '/';
            }, 2000);

        } catch (error) {
            console.error('Error en registro:', error);
            showMessage(error.message || 'Error al registrarse', 'error');
        } finally {
            // Rehabilitar botón
            registerBtn.disabled = false;
            registerBtn.textContent = 'Registrarse';
        }
    });

    function showMessage(message, type) {
        messageDiv.textContent = message;
        messageDiv.className = `message ${type}`;
        messageDiv.style.display = 'block';
        
        // Ocultar mensaje después de 5 segundos
        setTimeout(() => {
            messageDiv.style.display = 'none';
        }, 5000);
    }

    function isValidEmail(email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
    }
});
</script>

<style>
.message {
    margin: 15px 0;
    padding: 10px;
    border-radius: 5px;
    text-align: center;
    font-weight: 500;
}

.message.success {
    background-color: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

.message.error {
    background-color: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

#registerBtn:disabled {
    opacity: 0.7;
    cursor: not-allowed;
}
</style>

</body>
</html>