<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo Sistema de Autenticaci√≥n - TP Descuentos</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 30px;
        }
        
        .demo-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            background: #f9f9f9;
        }
        
        .demo-section h2 {
            color: #555;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: background 0.3s ease;
        }
        
        button:hover {
            background: #5a6fd8;
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .result.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .result.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .result.info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        
        .auth-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 15px;
            border-radius: 5px;
            font-weight: 500;
            z-index: 1000;
        }
        
        .auth-status.authenticated {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .auth-status.not-authenticated {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .token-display {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            word-break: break-all;
        }
        
        .nav-links {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .nav-links a {
            margin: 0 10px;
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
        }
        
        .nav-links a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="auth-status" id="authStatus">Verificando...</div>
    
    <div class="container">
        <h1>üîê Demo Sistema de Autenticaci√≥n</h1>
        
        <div class="nav-links">
            <a href="/">‚Üê Volver al Inicio</a>
            <a href="/login">P√°gina de Login</a>
            <a href="/signup.html">P√°gina de Registro</a>
            <a href="/promociones">Ver Promociones</a>
        </div>
        
        <!-- Registro -->
        <div class="demo-section">
            <h2>üìù Registro de Usuario</h2>
            <form id="registerForm">
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="regEmail" value="demo@ejemplo.com" required>
                </div>
                <div class="form-group">
                    <label>Contrase√±a:</label>
                    <input type="password" id="regPassword" value="123456" required>
                </div>
                <div class="form-group">
                    <label>Nombre:</label>
                    <input type="text" id="regNombre" value="Usuario" required>
                </div>
                <div class="form-group">
                    <label>Apellido:</label>
                    <input type="text" id="regApellido" value="Demo" required>
                </div>
                <button type="submit">Registrar Usuario</button>
                <button type="button" onclick="clearResult('registerResult')">Limpiar</button>
            </form>
            <div id="registerResult" class="result" style="display: none;"></div>
        </div>
        
        <!-- Login -->
        <div class="demo-section">
            <h2>üîë Iniciar Sesi√≥n</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="loginEmail" value="demo@ejemplo.com" required>
                </div>
                <div class="form-group">
                    <label>Contrase√±a:</label>
                    <input type="password" id="loginPassword" value="123456" required>
                </div>
                <button type="submit">Iniciar Sesi√≥n</button>
                <button type="button" onclick="clearResult('loginResult')">Limpiar</button>
            </form>
            <div id="loginResult" class="result" style="display: none;"></div>
        </div>
        
        <!-- Perfil -->
        <div class="demo-section">
            <h2>üë§ Obtener Perfil</h2>
            <p>Requiere estar autenticado para funcionar.</p>
            <button onclick="getProfile()">Obtener Mi Perfil</button>
            <button type="button" onclick="clearResult('profileResult')">Limpiar</button>
            <div id="profileResult" class="result" style="display: none;"></div>
        </div>
        
        <!-- Verificar Token -->
        <div class="demo-section">
            <h2>üîç Verificar Token</h2>
            <p>Verifica si el token actual es v√°lido.</p>
            <button onclick="verifyToken()">Verificar Token</button>
            <button type="button" onclick="clearResult('verifyResult')">Limpiar</button>
            <div id="verifyResult" class="result" style="display: none;"></div>
        </div>
        
        <!-- Estado Actual -->
        <div class="demo-section">
            <h2>üìä Estado Actual</h2>
            <button onclick="showCurrentState()">Mostrar Estado</button>
            <button onclick="authService.logout(); updateAuthStatus()">Cerrar Sesi√≥n</button>
            <button type="button" onclick="clearResult('stateResult')">Limpiar</button>
            <div id="stateResult" class="result" style="display: none;"></div>
        </div>
        
        <!-- Pruebas Autom√°ticas -->
        <div class="demo-section">
            <h2>üß™ Pruebas Autom√°ticas</h2>
            <p>Ejecuta todas las pruebas autom√°ticamente.</p>
            <button onclick="runAutoTests()">Ejecutar Todas las Pruebas</button>
            <button type="button" onclick="clearResult('autoTestResult')">Limpiar</button>
            <div id="autoTestResult" class="result" style="display: none;"></div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/front/services/auth.js"></script>
    <script>
        // Variables globales
        let currentToken = null;

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            updateAuthStatus();
            setupForms();
        });

        // Configurar eventos de formularios
        function setupForms() {
            document.getElementById('registerForm').addEventListener('submit', handleRegister);
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
        }

        // Actualizar estado de autenticaci√≥n
        function updateAuthStatus() {
            const statusEl = document.getElementById('authStatus');
            if (authService.isAuthenticated()) {
                const user = authService.getUser();
                statusEl.textContent = `‚úÖ Autenticado: ${user.nombre} ${user.apellido}`;
                statusEl.className = 'auth-status authenticated';
                currentToken = authService.getToken();
            } else {
                statusEl.textContent = '‚ùå No autenticado';
                statusEl.className = 'auth-status not-authenticated';
                currentToken = null;
            }
        }

        // Manejar registro
        async function handleRegister(e) {
            e.preventDefault();
            const resultEl = document.getElementById('registerResult');
            
            try {
                showResult(resultEl, 'Registrando usuario...', 'info');
                
                const userData = {
                    email: document.getElementById('regEmail').value,
                    password: document.getElementById('regPassword').value,
                    nombre: document.getElementById('regNombre').value,
                    apellido: document.getElementById('regApellido').value
                };

                const result = await authService.register(userData);
                showResult(resultEl, JSON.stringify(result, null, 2), 'success');
                updateAuthStatus();
                
            } catch (error) {
                showResult(resultEl, `Error: ${error.message}`, 'error');
            }
        }

        // Manejar login
        async function handleLogin(e) {
            e.preventDefault();
            const resultEl = document.getElementById('loginResult');
            
            try {
                showResult(resultEl, 'Iniciando sesi√≥n...', 'info');
                
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;

                const result = await authService.login(email, password);
                showResult(resultEl, JSON.stringify(result, null, 2), 'success');
                updateAuthStatus();
                
            } catch (error) {
                showResult(resultEl, `Error: ${error.message}`, 'error');
            }
        }

        // Obtener perfil
        async function getProfile() {
            const resultEl = document.getElementById('profileResult');
            
            try {
                showResult(resultEl, 'Obteniendo perfil...', 'info');
                
                const profile = await authService.getProfile();
                showResult(resultEl, JSON.stringify(profile, null, 2), 'success');
                
            } catch (error) {
                showResult(resultEl, `Error: ${error.message}`, 'error');
            }
        }

        // Verificar token
        async function verifyToken() {
            const resultEl = document.getElementById('verifyResult');
            
            try {
                showResult(resultEl, 'Verificando token...', 'info');
                
                const isValid = await authService.verifyToken();
                const message = isValid ? 'Token v√°lido ‚úÖ' : 'Token inv√°lido ‚ùå';
                showResult(resultEl, message, isValid ? 'success' : 'error');
                
            } catch (error) {
                showResult(resultEl, `Error: ${error.message}`, 'error');
            }
        }

        // Mostrar estado actual
        function showCurrentState() {
            const resultEl = document.getElementById('stateResult');
            
            const state = {
                isAuthenticated: authService.isAuthenticated(),
                user: authService.getUser(),
                token: authService.getToken() ? authService.getToken().substring(0, 50) + '...' : null,
                localStorage: {
                    tokenKey: 'tp-descuentos-token',
                    userKey: 'tp-descuentos-user',
                    hasToken: !!localStorage.getItem('tp-descuentos-token'),
                    hasUser: !!localStorage.getItem('tp-descuentos-user')
                }
            };
            
            showResult(resultEl, JSON.stringify(state, null, 2), 'info');
        }

        // Ejecutar pruebas autom√°ticas
        async function runAutoTests() {
            const resultEl = document.getElementById('autoTestResult');
            let log = 'Iniciando pruebas autom√°ticas...\\n\\n';
            
            showResult(resultEl, log, 'info');
            
            try {
                // Test 1: Registro
                log += '1. Probando registro...\\n';
                showResult(resultEl, log, 'info');
                
                const testUser = {
                    email: `test${Date.now()}@demo.com`,
                    password: '123456',
                    nombre: 'Test',
                    apellido: 'Auto'
                };
                
                await authService.register(testUser);
                log += '   ‚úÖ Registro exitoso\\n\\n';
                
                // Test 2: Perfil
                log += '2. Probando obtener perfil...\\n';
                showResult(resultEl, log, 'info');
                
                const profile = await authService.getProfile();
                log += `   ‚úÖ Perfil obtenido: ${profile.email}\\n\\n`;
                
                // Test 3: Verificar token
                log += '3. Probando verificaci√≥n de token...\\n';
                showResult(resultEl, log, 'info');
                
                const isValid = await authService.verifyToken();
                log += `   ‚úÖ Token v√°lido: ${isValid}\\n\\n`;
                
                // Test 4: Logout
                log += '4. Probando cerrar sesi√≥n...\\n';
                showResult(resultEl, log, 'info');
                
                await authService.logout();
                log += '   ‚úÖ Sesi√≥n cerrada\\n\\n';
                
                log += 'üéâ Todas las pruebas completadas exitosamente!';
                showResult(resultEl, log, 'success');
                updateAuthStatus();
                
            } catch (error) {
                log += `\\n‚ùå Error en las pruebas: ${error.message}`;
                showResult(resultEl, log, 'error');
            }
        }

        // Mostrar resultado
        function showResult(element, content, type) {
            element.textContent = content;
            element.className = `result ${type}`;
            element.style.display = 'block';
        }

        // Limpiar resultado
        function clearResult(elementId) {
            const element = document.getElementById(elementId);
            element.style.display = 'none';
            element.textContent = '';
        }
    </script>
</body>
</html>
